{% extends 'layout.html' %}
{% block content %}
<div class = 'spread4' style="min-height: 100vh;">
    <form class = 'inline mb-5' onsubmit = 'view(event)'>
    <div class='row mb-5 mt-5'>
        <div class='col-sm-6'>
            <div class="input-group-prepend col-sm">
                <span class="input-group-text  mb-2">Date range</span>
                <input type="text" placeholder="Start date" aria-label="First name" class="form-control start-date  mb-2 "
                    id='startDateG' required>
                <input type="text" placeholder="End date" aria-label="Last name" class="form-control end-date  mb-2 mr-sm-2"
                    id='endDateG' required>
            </div>
        </div>
    </div>
    <span class = 'badge badge-primary mb-5'>
        Filters (Not Mandatory)
    </span>
    <div class = 'row mb-5'>
        <div class='col-sm-2'>
            <select class='form-control' id = 'leadtime'>
                <option selected disabled>
                    Booking Lead Time
                </option>
                <option>
                    0 - 14
                </option>
                <option>
                    14 - 45
                </option>
                <option>
                    45 - 120
                </option>
                <option>
                    120 - 180
                </option>
                <option>
                    180 +
                </option>
            </select>
        </div>
        <div class = 'col-sm-3'>
            <select class='form-control text-center' id='category' style='max-width: 60%;'>
                <option disabled selected>
                    Category
                </option>
                <option>
                    Bachelor-ette party
                </option>
                <option>
                    Business meeting
                </option>
                <option>
                    Corporate incentive travel
                </option>
                <option>
                    Class re-union
                </option>
                <option>
                    Family
                </option>
                <option>
                    Military
                </option>
                <option>
                    Music band
                </option>
                <option>
                    Religious/Church event
                </option>
                <option>
                    Sport team
                </option>
                <option>
                    Theatre
                </option>
                <option>
                    Wedding
                </option>
                <option>
                    Other
                </option>
            </select>
        </div>
        <div class = 'col-sm-3'>
            <select class = 'form-control text-center' style = 'max-width: 60%;' id = 'customerType'>
                <option disabled selected>
                    Customer Type
                </option>
                <option value = 'iata'>
                    IATA
                </option>
                <option value = 'corporate'>
                    Corporate
                </option>
                <option value = 'retail'>
                    Retail
                </option>
                <option value = 'tour'>
                    Tour Operator
                </option>
            </select>
        </div>
        <div class='col-sm-3'>
            <select class='form-control text-center' style='max-width: 50%;' id = 'status'>
                <option disabled selected>
                    Status
                </option>
                <option>
                    NEW
                </option>
                <option>
                    QUOTED
                </option>
                <option>
                    NEGOTIATED
                </option>
                <option>
                    ACCEPTED
                </option>
                <option>
                    CUSTOMER DECLINED
                </option>
                <option>
                    DELETED
                </option>
                <option>
                    SENT FOR REVIEW
                </option>
                <option>
                    HOTEL DECLINED
                </option>
                <option>
                    EXPIRED
                </option>
                <option>
                    CONFIRMED
                </option>
                <option>
                    NOT CONFIRMED
                </option>
            </select>
        </div>
    </div>
    <div class = 'row mb-5'>
        <div class='col-sm-6'>
            <button type='submit' class='btn btn-info'>View Count</button>
        </div>
    </div>
    </form>
    <hr>
    <div class='table-responsive mb-5'>
        <table class='table table-bordered table-hover' id='tablefilllead'>
            <caption>Request Details in given date range</caption>
            <thead class='thead-dark'>
                <tr>
                    <th>
                        Booking Lead Time
                    </th>
                    <th>
                        Count
                    </th>
                    <th>
                        Length of Stay
                    </th>
                </tr>
            </thead>
            <tbody>
    
            </tbody>
        </table>
    </div>
    <div class = 'table-responsive mb-5'>
        <table class = 'table table-bordered table-hover' id = 'tablefillcategory'>
            <caption>Request Details in given date range</caption>
            <thead class = 'thead-dark'>
                <tr>
                    <th>
                        Category
                    </th>
                    <th>
                        Count
                    </th>
                    <th>
                        Length of Stay
                    </th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
    <div class='table-responsive mb-5'>
        <table class='table table-bordered table-hover' id='tablefillcustomer'>
            <caption>Request Details in given date range</caption>
            <thead class='thead-dark'>
                <tr>
                    <th>
                        Customer Type
                    </th>
                    <th>
                        Count
                    </th>
                    <th>
                        Length of Stay
                    </th>
                </tr>
            </thead>
            <tbody>
    
            </tbody>
        </table>
    </div>
    <div class='table-responsive mb-5'>
        <table class='table table-bordered table-hover' id='tablefillstatus'>
            <caption>Request Details in given date range</caption>
            <thead class='thead-dark'>
                <tr>
                    <th>
                        Status
                    </th>
                    <th>
                        Count
                    </th>
                    <th>
                        Length of Stay
                    </th>
                </tr>
            </thead>
            <tbody>
    
            </tbody>
        </table>
    </div>

</div>


<script src="/static/js/jquery.js"></script>
<script src="/static/js/Chart.bundle.js"></script>
<script>

     $(document).ready(function () {
         var $startDate = $('.start-date');
         var $endDate = $('.end-date');

        var d2 = new Date();
        d2.setDate(d2.getDate() + 31);
        var strDate2 = d2.getDate() + "/" + (d2.getMonth() + 1) + "/" + d2.getFullYear()

         $startDate.datepicker({
             autoHide: true,
             format: "dd/mm/yyyy",
         });
         $endDate.datepicker({
             autoHide: true,
             endDate : strDate2,
             format: "dd/mm/yyyy",
         });

         $startDate.on('change', function () {
              var d2 = $startDate.datepicker('getDate');
             d2.setDate(d2.getDate() + 31);
             var tDate = d2.getDate() + "/" + (d2.getMonth() + 1) + "/" + d2.getFullYear()
             $endDate.datepicker('setStartDate', $startDate.datepicker('getDate'));
             $endDate.datepicker('setEndDate',tDate);
         });
    });




    function parseDate2(x) {
        return x.split("/").reverse().join("/");
    }

    function view(e) {
        e.preventDefault()
        const startDate = parseDate2($("#startDateG").val())
        const endDate = parseDate2($("#endDateG").val())
        const leadtime = $("#leadtime option:selected").text().trim();
        const category = $("#category option:selected").text().trim();
        const customerType = $("#customerType option:selected").val();
        const status = $("#status option:selected").text().trim();

       var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                const response = JSON.parse(xhttp.responseText)
                const leadres = response['leadres']
                if (leadres.length == 1) {
                    const tbody1 = document.getElementById('tablefilllead').children[2]
                    const tr = document.createElement('tr')
                    tr.innerHTML = `
                        <td>
                            ${leadres[0]['0']}
                        </td>
                        <td>
                            ${leadres[0]['1']}
                        </td>
                        <td>
                            ${leadres[0]['2']}
                        </td>
                    `
                    tbody1.appendChild(tr)
                } else {
                    const tbody1 = document.getElementById('tablefilllead').children[2]
                    for (let i=0; i<leadres.length; i++) {
                        const tr = document.createElement('tr')
                        tr.innerHTML = `
                        <td>
                            ${leadres[i]['0']}
                        </td>
                        <td>
                            ${leadres[i]['1']}
                        </td>
                        <td>
                            ${leadres[i]['2']}
                        </td>
                    `
                        tbody1.appendChild(tr)
                    }
                }
                const catres = response['catres']
                if (catres.length == 1) {
                    const tbody1 = document.getElementById('tablefillcategory').children[2]
                    const tr = document.createElement('tr')
                    tr.innerHTML = `
                        <td>
                            ${catres[0]['0']}
                        </td>
                        <td>
                            ${catres[0]['1']}
                        </td>
                        <td>
                            ${catres[0]['2']}
                        </td>
                    `
                    tbody1.appendChild(tr)
                } else {
                    const tbody1 = document.getElementById('tablefillcategory').children[2]
                    for (let i = 0; i < catres.length; i++) {
                        const tr = document.createElement('tr')
                        tr.innerHTML = `
                        <td>
                            ${catres[i]['0']}
                        </td>
                        <td>
                            ${catres[i]['1']}
                        </td>
                        <td>
                            ${catres[i]['2']}
                        </td>
                    `
                        tbody1.appendChild(tr)
                    }
                }
                const custres = response['custres']
                if (custres.length == 1) {
                    const tbody1 = document.getElementById('tablefillcustomer').children[2]
                    const tr = document.createElement('tr')
                    tr.innerHTML = `
                        <td>
                            ${custres[0]['0']}
                        </td>
                        <td>
                            ${custres[0]['1']}
                        </td>
                        <td>
                            ${custres[0]['2']}
                        </td>
                    `
                    tbody1.appendChild(tr)
                } else {
                    const tbody1 = document.getElementById('tablefillcustomer').children[2]
                    for (let i = 0; i < custres.length; i++) {
                        const tr = document.createElement('tr')
                        tr.innerHTML = `
                        <td>
                            ${custres[i]['0']}
                        </td>
                        <td>
                            ${custres[i]['1']}
                        </td>
                        <td>
                            ${custres[i]['2']}
                        </td>
                    `
                        tbody1.appendChild(tr)
                    }
                }

                const statusres = response['statusres']
                if (statusres.length == 1) {
                    const tbody1 = document.getElementById('tablefillstatus').children[2]
                    const tr = document.createElement('tr')
                    tr.innerHTML = `
                        <td>
                            ${statusres[0]['0']}
                        </td>
                        <td>
                            ${statusres[0]['1']}
                        </td>
                        <td>
                            ${statusres[0]['2']}
                        </td>
                    `
                    tbody1.appendChild(tr)
                } else {
                    const tbody1 = document.getElementById('tablefillstatus').children[2]
                    for (let i=0; i<statusres.length; i++) {
                        const tr = document.createElement('tr')
                        tr.innerHTML = `
                            <td>
                                ${statusres[i]['0']}
                            </td>
                            <td>
                                ${statusres[i]['1']}
                            </td>
                            <td>
                                ${statusres[i]['2']}
                            </td>
                        `
                        tbody1.appendChild(tr)
                    }
                }

            }
        };
        var target = new URL("http://localhost:5000/analyticsbehaviorGet")
        const params = new URLSearchParams();
        params.set('startDate', startDate)
        params.set('endDate', endDate)
        params.set('leadtime', leadtime)
        params.set('category', category)
        params.set('customerType', customerType)
        params.set('status', status)
        target.search = params.toString()

        xhttp.open("GET", target , true);
        xhttp.send();

        
    }





</script>
{% endblock %}