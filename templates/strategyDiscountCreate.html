{% extends 'layout.html' %}
{% block content %}

<div class="home">
    <div class="wrap-login spread3">
        <div class='loginH'>
            <div class='text-center'>
                <p>Discount Grid</p>
            </div>
        </div>
        <form id='formadd' class='inline mb-5'>
            <div class='mg mb-5'>
                <div class="input-group-prepend col-sm">
                    <span class="input-group-text  mb-2">Date range</span>
                    <input type="text" placeholder="Start date" aria-label="First name"
                        class="form-control start-date  mb-2 " id='startDateG' required>
                    <input type="text" placeholder="End date" aria-label="Last name"
                        class="form-control end-date  mb-2 mr-sm-2" id='endDateG' required>
                </div>
                <div class='col-sm mb-2'>
                    <input type = 'text' class = 'form-control' placeholder="Discount ID" style="width: 40%;" required>
                </div>
            </div>
        <div class = 'table-responsive'>
            <table class = 'table table-bordered table-hover' id = 'tab12'>
                <caption>Default Discount Grid</caption>
                <thead class = 'thead-dark'>
                    <tr>
                        <th rowspan="2">
                            Lead Time (Days)
                        </th>
                        <th>
                            OCC(%)
                        </th>   
                        <th colspan = '2'>
                            0 - 20%
                        </th>
                        <th colspan = '2'>
                            21 - 40%
                        </th>
                        <th colspan = '2'>
                            41 - 60%
                        </th>
                        <th colspan = '2'>
                            61 - 80%
                        </th>
                        <th colspan = '2'>
                            81 - 100%
                        </th>
                    </tr>
                    <tr>
                        <th>
                            Allocation
                        </th>
                        <th>
                            10(1-10)
                        </th>
                        <th>
                            10(11-20)
                        </th>
                        <th>
                            10(21-30)
                        </th>
                        <th>
                            10(31-40)
                        </th>
                        <th>
                            10(41-50)
                        </th>
                        <th>
                            10(51-60)
                        </th>
                        <th>
                            10(61-70)
                        </th>
                        <th>
                            10(71-80)
                        </th>
                        <th>
                            10(81-90)
                        </th>
                        <th>
                            10(91-100)
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            1 - 6
                        </td>
                        <td>
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>   
                        <td>    
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class = 'form-control' >
                        </td>
                    </tr>
                    <tr>
                        <td> 
                            7 - 13
                        </td>
                        <td>
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                    </tr>
                    <tr>
                        <td>
                            14 - 29
                        </td>
                        <td>
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                    </tr>
                    <tr>
                        <td>
                            30 - 59
                        </td>
                        <td>
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                    </tr>
                    <tr>
                        <td>
                            60 - 179
                        </td>
                        <td>
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                    </tr>
                    <tr>
                        <td>
                            180
                        </td>
                        <td>
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                        <td>
                            <input type='number' step = 'any' class='form-control' >
                        </td>
                    </tr>        
                </tbody>
            </table>
        </div>
        <div class = 'row'>
            <div class="col-sm-12 mt-3">
                <button class = 'btn btn-info' type = 'button' id = 'createGrid11' onclick = 'createGrid1(event)'>Create Grid</button>
            </div>
        </div>
        <div class='row mb-5'>
            <div class="col-sm-12 mt-3">
                <button class='btn btn-info' type='button' id='createGrid12' onclick='createGrid2(event)'>Back to Default Grid</button>
            </div>
        </div>
        <div class = 'mb-5' id = 'point'>
                <label class = 'mr-5' id = 'porq'>Enter OCC Range</label>
                <input type='number' class='form-control'  min=0 style = 'width:20%; display: inline-block;' max = 100 id = 'mincol' >
                <input type='number' class='form-control'  min=0 style = 'width:20%; display: inline-block;' max = 100 id = 'maxcol' >
                
                <button type = 'button' class = 'ml-5 btn btn-primary' onclick = 'addcol(event)' id = 'adc'>Add Column</button>

                <button type='button' class='ml-5 btn btn-primary' onclick='rescol(event)' id = 'fc'>Freeze Column</button>

                <button type='button' class='ml-5 btn btn-primary' onclick='lockGrid(event)' id='lc'>Lock Grid Columns</button>

                <button type='button' class='ml-5 btn btn-primary' onclick='addRow(event)' id='ar'>Add Row</button>

        </div>

        <div class='table-responsive'>
            <table class='table table-bordered table-hover' id='tab13'>
                <caption>Default Discount Grid</caption>
                <thead class='thead-dark'>
                    <tr>
                        <th rowspan="2">
                            Lead Time (Days)
                        </th>
                        <th>
                            OCC(%)
                        </th>
                    </tr>
                    <tr>
                        <th>
                            Allocation
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <input type='number' class='num3'>
                            <input type='number' class='num3'>`
                        </td>
                        <td>

                        </td>
                    </tr>
                </tbody>
            </table>
        </div>


        <div class="row">
            <div class="col-sm-12 mt-3">
                <div class="text-center">
                    <button type="submit" id='subm' class="btnLogin">Submit</button>
                </div>
            </div>
        </div>
        </form>
    </div>
</div>


<script src="/static/js/jquery.js"></script>
<script>
    $(document).ready(function () {
            $('#fc').hide()
            $('#lc').hide()
            $('#ar').hide()
            $('#createGrid12').hide()
            $('#tab13').hide()
            $('#point').hide()
            var $startDate = $('.start-date');
            var $endDate = $('.end-date');

            var d = new Date();
            var strDate = d.getDate() + "/" + (d.getMonth() + 1) + "/" + d.getFullYear()

            $startDate.datepicker({
                autoHide: true,
                format: "dd/mm/yyyy",
                startDate: strDate,
            });
            $endDate.datepicker({
                autoHide: true,
                startDate: $startDate.datepicker('getDate'),
                format: "dd/mm/yyyy",
            });

            $startDate.on('change', function () {
                $endDate.datepicker('setStartDate', $startDate.datepicker('getDate'));
            });
    });

    function createGrid1()
    {
        $('#tab12').hide()
        $('#tab13').show()
        $('#createGrid11').hide()
        $('#createGrid12').show()
        $('#point').show()
    }
    function createGrid2() {
        $('#tab12').show()
        $('#createGrid12').hide()
        $('#createGrid11').show()
        $('#tab13').hide()
        $('#point').hide()
    }

    function lockGrid(e) {
        const buttons = [...document.getElementsByClassName('rept')]
        buttons.forEach(button => {
            button.remove()
        })
        $('#mincol').hide()
        $('#maxcol').hide()
        $('#adc').hide()
        $('#fc').hide()
        $('#lc').hide()
        $('#porq').hide()

        $('#ar').show()
        
    }

    function addRow(e) {
        const table = document.getElementById('tab13')
        const tbody = table.children[2]
        const tr = tbody.children[0]
        let newTr = $(tr).clone(true)
        newTr = newTr[0]
        tbody.append(newTr)
    }

    function addcolcol(e) {
        const p = e.target.parentElement

        p.colSpan = p.colSpan + 1

        const g = p.parentElement.nextElementSibling;

        const th2 = document.createElement('th')

        th2.innerHTML = `
                        <input type = 'number' class = 'num3'>
                        <input type='number' class='num3'>`

        g.appendChild(th2)

        let tbody = document.getElementById('tab13').children
        [2]
        const td = document.createElement('td')
        td.innerHTML = `
                        <input type = 'number' class = 'num3'>`
        tbody = tbody.children[0]
        tbody.appendChild(td)

    }

    function rescol(e) {
        const min = document.getElementById('mincol')
        const max = document.getElementById('maxcol')
        min.disabled = false
        max.disabled = false
        min.value = ''
        max.value = ''

        $('#fc').hide()
        $('#adc').show()

        const buttons = [...document.getElementsByClassName('rept')]
        buttons.forEach(button => {
            button.remove()
        })

    }

    function addcol() {
        const min = document.getElementById('mincol')
        const max = document.getElementById('maxcol')

        $('#fc').show()
        $('#adc').hide()
        $('#lc').show()

        if (min.value == '') {
            alert('Enter Min value')
            return false
        }
        if (max.value == '') {
            alert('Enter Max value')
            return false
        }
        min.disabled = true
        max.disabled = true

        const table = document.getElementById('tab13')
        
        const theadr = table.children[1].children
        const th1 = document.createElement('th')
        const rooms = "{{ rooms|safe }}"
        const diff = max.value - min.value + 1
        const val = Math.floor((rooms * diff) / 100);
        th1.innerHTML = `${min.value} - ${max.value} (${val} rooms)
            <button type = 'button' class = 'btn btn-outline-warning rept' onclick = 'addcolcol(event)'>
                            +
                        </button>
        `

        theadr[0].append(th1)

        const th2 = document.createElement('th')
    
        th2.innerHTML = `
                        <input type = 'number' class = 'num3' min = ${min.value} max = ${max.value} value = ${min.value}>
                        <input type='number' class='num3'  min = ${min.value} max = ${max.value} value = ${max.value}>
                        `
        theadr[1].append(th2)

        const tbody = table.children[2]
        const trchildren = [...tbody.children]
        trchildren.forEach(tr => {
            const td = document.createElement('td')
            td.innerHTML = `<input type='number' step = 'any' class = 'num3' >`
            tr.appendChild(td)
        })

        
    }

</script>

{% endblock %}